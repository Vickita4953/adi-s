<!DOCTYPE html>
<title>Adiós profe :c</title>
<head>Espero nos volvamos a encontrar pronto</head>
<body>
    <h1>Gracias por enseñarnos mucho en este tecnología :D</h1>
    <h2>Fue divertido ver la historia del internet</h2>
    <button id="rainBtn">Click para lluvia</button>
    <canvas id="rainCanvas" style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:9999;"></canvas>
    <script>
    (function(){
      const btn = document.getElementById('rainBtn');
      const c = document.getElementById('rainCanvas');
      const ctx = c.getContext('2d');
      let w = 0, h = 0, drops = [], raf = null;

      function resize(){ w = c.width = innerWidth; h = c.height = innerHeight; }
      addEventListener('resize', resize);
      resize();

    function initDrops(count = 1000){
      // más gotas por defecto para mayor densidad
      drops = [];
      for(let i=0;i<count;i++){
        drops.push({
        x: Math.random()*w,
        y: Math.random()*h,
        vy: 4 + Math.random()*6,
        len: 10 + Math.random()*20,
        opacity: 0.2 + Math.random()*0.8, // un poco más opacas
        tilt: Math.random()*1.5
        });
      }

      // aplicar tema oscuro al iniciar la lluvia
      document.body.style.backgroundColor = '#000';
      document.body.style.color = '#fff';

      // observar el texto del botón para revertir el tema cuando se detenga la lluvia
      if(btn){
        // desconectar observador anterior si existe
        if(btn._rainObserver) btn._rainObserver.disconnect();
        // limpiar cualquier intervalo/elemento previo de "boquitas tristes"
        if(btn._sadInterval){ clearInterval(btn._sadInterval); delete btn._sadInterval; }
        if(btn._sadEl){ btn._sadEl.remove(); delete btn._sadEl; }

        // crear un observador que inicie/pare la escritura de ":c" debajo del botón
        const sadObserver = new MutationObserver(() => {
          const txt = btn.textContent.trim();
          if(txt === 'Detener lluvia'){
            // iniciar si no está ya iniciado
            if(!btn._sadEl){
              const sadEl = document.createElement('div');
              sadEl.style.marginTop = '8px';
              sadEl.style.fontFamily = 'monospace';
              sadEl.style.whiteSpace = 'pre';
              sadEl.style.fontSize = '18px';
              sadEl.style.color = '#fff';
              sadEl.textContent = ':c';
              btn.insertAdjacentElement('afterend', sadEl);
              btn._sadEl = sadEl;
              // cada 150ms agregar una "c"
            let colsPerLine = 70;
            let col = 0;
            btn._sadInterval = setInterval(() => {
                if(!btn._sadEl) return;
                if(col >= colsPerLine){
                    sadEl.textContent += '\n';
                    col = 0;
                }
                sadEl.textContent += 'c';
                col++;
            }, 30);
            }
          } else if(txt === 'Click para lluvia'){
            // detener y limpiar
            if(btn._sadInterval){ clearInterval(btn._sadInterval); delete btn._sadInterval; }
            if(btn._sadEl){ btn._sadEl.remove(); delete btn._sadEl; }
            sadObserver.disconnect();
            delete btn._sadObserver;
          }
        });

        sadObserver.observe(btn, { childList: true, subtree: true, characterData: true });
        btn._sadObserver = sadObserver;

        const observer = new MutationObserver(() => {
        if(btn.textContent.trim() === 'Click para lluvia'){
          // revertir estilos al detenerse
          document.body.style.backgroundColor = '';
          document.body.style.color = '';
          observer.disconnect();
          delete btn._rainObserver;
        }
        });

        observer.observe(btn, { childList: true, subtree: true, characterData: true });
        btn._rainObserver = observer;
      }
    }

      function draw(){
        ctx.clearRect(0,0,w,h);
        for(const d of drops){
          ctx.beginPath();
          ctx.strokeStyle = `rgba(174,194,224,${d.opacity})`;
          ctx.lineWidth = 1;
          ctx.moveTo(d.x, d.y);
          ctx.lineTo(d.x - d.vy * d.tilt, d.y + d.len);
          ctx.stroke();

          d.x += -1 + Math.random()*2; // slight horizontal drift
          d.y += d.vy;
          if(d.y > h){
            d.y = -20;
            d.x = Math.random()*w;
          }
        }
      }

      function loop(){ draw(); raf = requestAnimationFrame(loop); }

      function start(){
        if(raf) return;
        initDrops();
        loop();
        btn.textContent = 'Detener lluvia';
      }
      function stop(){
        if(!raf) return;
        cancelAnimationFrame(raf);
        raf = null;
        ctx.clearRect(0,0,w,h);
        btn.textContent = 'Click para lluvia';
      }

      btn.addEventListener('click', () => {
        if(raf) stop(); else start();
      });
    })();
    </script>
</body>